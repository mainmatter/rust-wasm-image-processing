<html>
    <head>
        <link data-trunk rel="scss" href="index.scss" />
        <link data-trunk rel="rust" />
        <link data-trunk rel="copy-file" href="../daisies.jpg" />
        <script>
            let defaultImageUrl = "/daisies.jpg";

            document.addEventListener("DOMContentLoaded", async () => {
                let response = await fetch(defaultImageUrl);
                let buffer = await response.arrayBuffer();
                imageData = new Uint8Array(buffer);
            });

            async function triggerBackend(url, params) {
                const queryString = new URLSearchParams({
                    image_url: `${window.location.origin}${defaultImageUrl}`,
                    ...params,
                }).toString();
                let response = await fetch(`/api/${url}?${queryString}`);
                let blob = await response.blob();
                imageElement.src = URL.createObjectURL(blob);
            }

            async function triggerWasm(endpoint, ...params) {
                let output = wasmBindings[endpoint](imageData, ...params);
                const blob = new Blob([output], { type: "image/jpeg" });
                imageElement.src = URL.createObjectURL(blob);
            }
        </script>
    </head>
    <body>
        <div>
            <a href="#" onclick="triggerBackend('exercise_1', {})">Backend exercise 1</a> |
            <a href="#" onclick="triggerBackend('exercise_2', { do_one_thing: false, value: 100 })">Backend exercise 2</a> |
            <a href="#" onclick="triggerWasm('exercise_1')">Wasm exercise 1</a> |
            <a href="#" onclick="triggerWasm('exercise_2', false, 100)">Wasm exercise 2</a>
        </div>
        <img id="imageElement" src="" />
    </body>
</html>
